<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> Best Programming Language ï¼Ÿ ğŸ˜ˆ JAVASCRIPT</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just learn and run">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d0f45259.js" as="script"><link rel="preload" href="/assets/js/2.9e697bc4.js" as="script"><link rel="preload" href="/assets/js/47.869f0654.js" as="script"><link rel="prefetch" href="/assets/js/10.48b8c953.js"><link rel="prefetch" href="/assets/js/11.f612be11.js"><link rel="prefetch" href="/assets/js/12.b835a644.js"><link rel="prefetch" href="/assets/js/13.be4ff992.js"><link rel="prefetch" href="/assets/js/14.bbd05573.js"><link rel="prefetch" href="/assets/js/15.1b4ee2f2.js"><link rel="prefetch" href="/assets/js/16.588a1728.js"><link rel="prefetch" href="/assets/js/17.ae68adab.js"><link rel="prefetch" href="/assets/js/18.68e9d6df.js"><link rel="prefetch" href="/assets/js/19.d2991acb.js"><link rel="prefetch" href="/assets/js/20.8fe6b2cd.js"><link rel="prefetch" href="/assets/js/21.12c5dbb4.js"><link rel="prefetch" href="/assets/js/22.ddd0487c.js"><link rel="prefetch" href="/assets/js/23.4cead595.js"><link rel="prefetch" href="/assets/js/24.0a65f294.js"><link rel="prefetch" href="/assets/js/25.0c8ed6b4.js"><link rel="prefetch" href="/assets/js/26.6591a69e.js"><link rel="prefetch" href="/assets/js/27.ff0fa1ef.js"><link rel="prefetch" href="/assets/js/28.858f8826.js"><link rel="prefetch" href="/assets/js/29.3f6b44e9.js"><link rel="prefetch" href="/assets/js/3.0b8b26d0.js"><link rel="prefetch" href="/assets/js/30.69cef0d1.js"><link rel="prefetch" href="/assets/js/31.576782ee.js"><link rel="prefetch" href="/assets/js/32.78085356.js"><link rel="prefetch" href="/assets/js/33.25cb7d39.js"><link rel="prefetch" href="/assets/js/34.d18511e2.js"><link rel="prefetch" href="/assets/js/35.6dc2bd90.js"><link rel="prefetch" href="/assets/js/36.b695c924.js"><link rel="prefetch" href="/assets/js/37.d803bac1.js"><link rel="prefetch" href="/assets/js/38.8abd0adb.js"><link rel="prefetch" href="/assets/js/39.3b23f090.js"><link rel="prefetch" href="/assets/js/4.e7c996f5.js"><link rel="prefetch" href="/assets/js/40.31a5553f.js"><link rel="prefetch" href="/assets/js/41.96f2dfc6.js"><link rel="prefetch" href="/assets/js/42.da2b78c0.js"><link rel="prefetch" href="/assets/js/43.2b80b114.js"><link rel="prefetch" href="/assets/js/44.03f54269.js"><link rel="prefetch" href="/assets/js/45.182bfe6b.js"><link rel="prefetch" href="/assets/js/46.cede0b20.js"><link rel="prefetch" href="/assets/js/48.b8a8b538.js"><link rel="prefetch" href="/assets/js/49.d919b506.js"><link rel="prefetch" href="/assets/js/5.6eff8140.js"><link rel="prefetch" href="/assets/js/50.b754644d.js"><link rel="prefetch" href="/assets/js/51.a3cf1047.js"><link rel="prefetch" href="/assets/js/52.4ee6e441.js"><link rel="prefetch" href="/assets/js/6.17d5dd20.js"><link rel="prefetch" href="/assets/js/7.576da1bf.js"><link rel="prefetch" href="/assets/js/8.6fffe5ac.js"><link rel="prefetch" href="/assets/js/9.0041b96e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Best Programming Language ï¼Ÿ ğŸ˜ˆ JAVASCRIPT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>frontend</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>vuejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/1.html" class="sidebar-link">new vue()ä¹‹å‰éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ˆä¸€ï¼‰</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/2.html" class="sidebar-link">new Vue(options) ä¸­çš„optionsåˆå¹¶å¤„ç†ï¼ˆäºŒï¼‰</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/3.html" class="sidebar-link">åœ¨new Vue(options)ä¸­æ˜¯å¦‚ä½•ä¸ºoptionsè¿›è¡Œåˆå§‹åŒ–ï¼ˆä¸‰ï¼‰</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/4.html" class="sidebar-link">initStateä¸å“åº”å¼åŸç†ï¼ˆå››ï¼‰</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/5.html" aria-current="page" class="active sidebar-link">ä»$mountåˆ°è™šæ‹Ÿdomï¼ˆäº”ï¼‰</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/diff.html" class="sidebar-link">diff æºç  æ³¨é‡Šç‰ˆ</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>å‰è¾¹å››ç« ï¼Œå¯¹å¦‚ä½•å¾—åˆ°ä¸€ä¸ªåŸºæœ¬çš„ vm å®ä¾‹è¿›è¡Œç»†è‡´çš„åˆ†è§£ï¼Œä»ç¯å¢ƒåˆå§‹åŒ–åˆ°æ•°æ®å“åº”å¼å†åˆ° wathcer dep ç­‰åŸºæœ¬æ¦‚å¿µï¼Œä½†æ˜¯è¿™ä¸ª vm è¿˜ä¸å®Œæ•´ï¼Œè¿˜æ²¡æœ‰å’Œè§†å›¾å…³è”èµ·æ¥ã€‚æœ¬ç« ä»$mount å¼€å§‹ï¼Œå¯¹æ¸²æŸ“è¿‡ç¨‹è¿›è¡Œå…¨é¢åˆ†æã€‚</p></blockquote> <ol><li>$mount</li> <li>mountComponent</li> <li>VNode</li> <li>Vue.prototype._render</li> <li>slot scopedSlot</li> <li>_c</li></ol> <h4 id="mount"><a href="#mount" class="header-anchor">#</a> $mount</h4> <p>ç»è¿‡<code>Vue.prototype.init</code>ä¹‹åå°±ä¼šæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼Œå¯ä»¥å‘ç°æ‰§è¡Œäº†ä¸¤æ¬¡$mount çš„èµ‹å€¼ï¼Œåœ¨<code>vue.esm.js</code>ä¸­æœ‰å¦‚ä¸‹å¯¹<code>$mount</code>çš„èµ‹å€¼å’Œæ“ä½œï¼Œå¯¹ä¸¤ä¸ª$mount è¿›è¡Œç¼–å·ä¸º m1 å’Œ m2ï¼Œä»¥ä¾¿åˆ†æ:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// m1</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> inBrowser <span class="token operator">?</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount<span class="token punctuation">;</span>

<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// m2</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template<span class="token punctuation">;</span>
    <span class="token comment">// æŠŠæ¨¡ç‰ˆç¼–è¯‘æˆrenderå‡½æ•°ä¾›åç»­ä½¿ç”¨</span>
    <span class="token keyword">var</span> ref <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>
      template<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">/* compiler options */</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> render <span class="token operator">=</span> ref<span class="token punctuation">.</span>render<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>render <span class="token operator">=</span> render<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>m1ï¼šä»£ç éå¸¸ç®€å•æ¸…æ™°ï¼Œä»…ä»…é€šè¿‡<code>mountComponent</code>æŠŠå½“å‰ vm(ä¹Ÿå°±æ˜¯å‚æ•°<code>this</code>)å®ä¾‹æŒ‚è½½åˆ°<code>el</code>ä¸Šå»ï¼Œå¯ä»¥è”æƒ³æˆ‘ä»¬åœ¨ä½¿ç”¨$mount ä¼ å…¥çš„å‚æ•° <code>new Vue().$mount('#app')</code>,å¯ä»¥å‘ç°ä¼ å…¥çš„å‚æ•°å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŒ‚è½½åˆ°çš„å…ƒç´ æ ‡å¿—ã€‚å®é™…ä¸Š<code>mount</code>çš„è¿‡ç¨‹å†…éƒ¨å°±æ˜¯ç”Ÿæˆ<code>vnode</code>ï¼Œå†æŒ‚è½½åˆ°çœŸå®çš„<code>dom</code>æ ‘ä¸­ã€‚</li> <li>m2ï¼šé¦–å…ˆç¼“å­˜äº† m1ï¼Œä¸º m1 åŒ…è£…ä¸€å±‚æ–°çš„åŠŸèƒ½ï¼Œç„¶åå¯¹<code>$mount</code>è¿›è¡ŒäºŒæ¬¡èµ‹å€¼ï¼Œå°†åŒ…å«æ–°åŠŸèƒ½çš„æŒ‚è½½å‡½æ•°èµ‹ç»™<code>$mount</code>ã€‚å†æ¥çœ‹ m2 ç›¸å¯¹äº m1 å¤šäº†ä¸€éƒ¨åˆ†åˆ¤æ–­ï¼Œå°±æ˜¯æŸ¥çœ‹å½“å‰ä¼ å…¥çš„ options æ˜¯ä¸æ˜¯åŒ…å« render å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ render å‡½æ•°å°±å»è¿›è¡Œä¸€æ¬¡æ¨¡ç‰ˆç¼–è¯‘ï¼Œå¾—åˆ° render å‡½æ•°ä¹‹åå†å»è¿›è¡Œ m1 çš„æ­¥éª¤ã€‚</li> <li>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿç­”æ¡ˆæ˜¯ï¼šm1 æ˜¯ä¸º<code>vue.runtime.js</code>æœåŠ¡çš„ï¼Œè€Œ m2 æ˜¯<code>vue.esm.js</code>çš„<code>$mount</code>æ–¹æ³•ï¼Œå®˜æ–¹ä»‹ç»ä¸­ä¹Ÿæ˜ç¡®æŒ‡æ˜ runtime ç‰ˆæœ¬å¹¶ä¸åŒ…å«ç¼–è¯‘å™¨ï¼Œä¹Ÿæ˜¯ä¸ºäº†å‡å°åŒ…çš„ä½“ç§¯ã€‚ä¸ºäº†æœ€å¤§ç¨‹åº¦çš„ä»£ç å¤ç”¨å’Œè§£è€¦ï¼Œå°†éè¿è¡Œæ—¶çš„æ¨¡ç‰ˆç¼–è¯‘éƒ¨åˆ†å’ŒçœŸæ­£çš„è¿è¡Œæ—¶ä»£ç è¿›è¡Œäº†åˆ†å‰²ã€‚è¿™é‡Œå·§å¦™çš„ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ·»åŠ äº†æ–°çš„åŠŸèƒ½ã€‚</li></ul> <h4 id="mountcomponent"><a href="#mountcomponent" class="header-anchor">#</a> mountComponent</h4> <p>æŸ¥çœ‹å¦‚ä¸‹ç®€åŒ–åçš„ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el<span class="token punctuation">;</span> <span class="token comment">// $el</span>

  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&quot;beforeMount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// beforeMount é’©å­</span>

  <span class="token keyword">var</span> <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// watcher.getter</span>
    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
    vm<span class="token punctuation">,</span>
    updateComponent<span class="token punctuation">,</span>
    noop<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// watcher.options ä¼ å…¥beforeæ–¹æ³•</span>
      <span class="token function-variable function">before</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>_isDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&quot;beforeUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&quot;mounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>callHook</code> å¯ä»¥çœ‹åˆ°åœ¨å‡½æ•°å¼€å§‹ï¼Œç»“æŸå’Œ<code>before</code>å‡½æ•°ä¸­åˆ†åˆ«æ‰§è¡Œäº† 3 æ¬¡<code>callHook</code>ï¼Œåˆ†åˆ«è°ƒç”¨äº†<code>beforeMounted</code>,<code>mounted</code>,<code>beforeUpdated</code>å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¹Ÿå°±å¯¹åº”äº† vue ç”Ÿå‘½å‘¨æœŸçš„è¿™å‡ ä¸ªé’©å­-<code>æŒ‚è½½å‰ æŒ‚è½½å æ›´æ–°å‰</code>ã€‚æ¥ä¸‹æ¥æŸ¥çœ‹<code>callHook</code>çš„å…·ä½“å®ç°ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">callHook</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> hook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> handlers <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">[</span>hook<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">invokeWithErrorHandling</span><span class="token punctuation">(</span>handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_hasHookEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;hook:&quot;</span> <span class="token operator">+</span> hook<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦ä¸€ä¸ªé’©å­å‡½æ•°çš„å…¥å£</span>
  <span class="token punctuation">}</span>
  <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é¦–å…ˆ<code>pushTarget</code>ï¼Œæœ€ååˆ<code>popTarget</code>ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†é¿å… bugï¼Œå› ä¸ºåœ¨è°ƒç”¨é’©å­å‡½æ•°çš„æ—¶å€™ä¹Ÿå¾ˆå¯èƒ½å»æ“ä½œå“åº”å¼æ•°æ®ï¼Œæ“ä½œçš„æ—¶å€™å°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå¯¼è‡´å¾ˆå¤šæœªçŸ¥é”™è¯¯ï¼Œå…¶å®<code>pushTarget()</code>å°±ç­‰åŒäº<code>pushTarget(undefined)</code>ï¼Œå› ä¸ºåœ¨è¿›è¡Œä¾èµ–æ”¶é›†çš„æ—¶å€™ä¼šæŠŠæ ˆé¡¶å…ƒç´ ä½œä¸ºç›®æ ‡ï¼Œä½†æ˜¯å¦‚æœæ ˆé¡¶å…ƒç´ å¼<code>undefined</code>çš„è¯å°±ä¼šåœæ­¢è¿›è¡Œä¾èµ–æ”¶é›†ã€‚
ä¹‹åå°±æ˜¯æ‹¿åˆ°<code>handlers</code>ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨<code>options</code>ä¸­é…ç½®çš„å„ç§é’©å­å‡½æ•°ï¼Œç„¶åé€šè¿‡å…·æœ‰é”™è¯¯å¤„ç†å™¨çš„æ–¹æ³•æ‰§è¡Œå™¨å»æ‰§è¡Œç”¨æˆ·çš„é’©å­ã€‚è¿™é‡Œ vue è¿˜ç•™äº†ä¸€ä¸ªé¢å¤–çš„å£å­ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨<code>$on('hook:mounted',()=&gt;{ })</code>æˆ–è€…<code>$once('hook:mounted',()=&gt;{ })</code>è¿›è¡Œé’©å­å‡½æ•°çš„æ³¨å†Œï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ‰§è¡Œåˆ°ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„å°±æ˜¯ä»£ç ä¸ä¼šå¤ªé›¶æ•£æ›´å…·é€»è¾‘æ€§ï¼ˆåœ¨ vue3 ä¸‹å°±ä¸å­˜åœ¨ä»£ç é›¶æ•£çš„é—®é¢˜äº†ï¼Œæ›´é€‚åˆå¤§å‹é¡¹ç›®ï¼‰ï¼Œæ¯”å¦‚å®šæ—¶å™¨çš„å¼€å¯å’Œå…³é—­éƒ½å†™åœ¨<code>methods</code>çš„æŸä¸ªæ–¹æ³•ä¸­,å¦‚ä¸‹,è¿™æ ·ä¸€æ¥å°±å¯ä»¥åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­æŠŠå®šæ—¶å™¨ä½¿ç”¨å’Œé”€æ¯éƒ½å®šä¹‰å®Œæ¯•ï¼Œæ›´æ¸…æ™°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token function">setInter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      	<span class="token comment">//éœ€è¦åšçš„äº‹æƒ…</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$once</span><span class="token punctuation">(</span><span class="token string">'hook:beforeDestroy'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>new Watcher()</code>ï¼Œåœ¨<code>beforeMount</code> å’Œ <code>mounted</code>ä¹‹é—´ï¼Œå¾ˆæ˜¾ç„¶åœ¨åˆå§‹åŒ– wathcer çš„è¿‡ç¨‹ä¸­å®Œæˆäº†ç»„ä»¶çš„æŒ‚è½½ã€‚å¯¹äºä¼ å…¥çš„å‚æ•°è¿›è¡Œç®€è¦åˆ†æï¼š
<ul><li><code>vm</code> å½“å‰ç»„ä»¶ vm å®ä¾‹</li> <li><code>updateComponents</code>ï¼Œæ ¹æ®å‰å‡ ç« çš„åˆ†æå¾—çŸ¥ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>wathcer.getter</code>ï¼Œæœ€åä¼šæ‰§è¡Œè¿™ä¸ª<code>getter</code>ï¼Œå¯¹äºæ¸²æŸ“<code>wathcer.getter</code>å°±æ˜¯æ¸²æŸ“å½“å‰<code>vm</code>å¯¹åº”çš„<code>vnode</code>ï¼Œå¹¶<code>update</code>åˆ°çœŸå®<code>dom</code>æ ‘ä¸­å»ï¼</li> <li><code>noop</code> å›è°ƒå‡½æ•°ï¼Œå¯¹äºæ¸²æŸ“è¿‡ç¨‹ä¸­ä¸éœ€è¦å›è°ƒå‡½æ•°ã€‚</li> <li><code>{ before:function(){} }</code> wathcer é…ç½®é¡¹ï¼Œbefore ä½œä¸ºæ¯æ¬¡ wathcer æ‰§è¡Œæ›´æ–°å‰çš„é’©å­ä¼ å…¥å…¶ä¸­ï¼Œå¯¹åº”çš„é’©å­å°±æ˜¯ç”¨æˆ·ä¼ å…¥çš„<code>beforeUpdate</code>é’©å­ã€‚</li> <li><code>isRenderWatcher</code> æ ‡å¿—ï¼Œä»…ä»…ä»£è¡¨å½“å‰ watcher æ˜¯æ¸²æŸ“ watcher</li></ul></li></ul> <h4 id="vnode"><a href="#vnode" class="header-anchor">#</a> VNode</h4> <p>åœ¨è®²è§£ render ä¹‹å‰ï¼Œå…ˆç®€å•è¯´è¯´ vnodeï¼Œvnode æ˜¯è™šæ‹Ÿ dom å¯¹è±¡ï¼Œvnode å°±æ˜¯ä¸€ä¸ªç®€å•çš„ javascript å¯¹è±¡ï¼Œæè¿°äº†ä¸€ä¸ªåœ¨çœŸå® dom ä¸­èŠ‚ç‚¹çš„æ ·å­æˆ–è€…æ˜¯ç»„ä»¶èŠ‚ç‚¹çš„æ ·å­ï¼Œå…¶å‡ºç°çš„åŸå› æ˜¯å› ä¸ºæ“ä½œåŸç”Ÿ dom è¿›è¡Œé¢‘ç¹çš„å¢åˆ æ€§èƒ½ä½ï¼Œè€Œæ˜¯é€šè¿‡ vnode-diff æ“ä½œåè¿›è¡Œä¿®æ”¹å…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå¦å¤– vnode è¿˜æä¾›äº†æŠ½è±¡æ€§ï¼Œä¾‹å¦‚ web å¹³å°ä¸‹å’Œ weex å¹³å°ä¸‹çš„ dom æ“ä½œä¸å°½ç›¸åŒï¼Œä½†æ˜¯ä»–ä»¬å¯¹åº”åŒä¸€ä»½ vnodeï¼Œæä¾›äº†æŠ½è±¡å±‚ä¹Ÿå°±æ›´åˆ©äºå¤šå¹³å°å»å®ç°è¿™ä¸ªæŠ½è±¡å±‚ï¼Œè€Œå“åº”å¼ç³»ç»Ÿç­‰åŸºäºæŠ½è±¡å±‚çš„æ ¸å¿ƒå†…å®¹éƒ½æ˜¯åŒä¸€ä»½ä»£ç ã€‚åªæœ‰åˆ°äº† update ä¹‹åæ‰ä¼šè¿›è¡ŒçœŸå®çš„ dom æ“ä½œï¼Œä¹Ÿå°±æ˜¯ patch ä¸­ä¼šè°ƒç”¨å¹³å°ç›¸å…³çš„ dom å¢åˆ æ“ä½œï¼Œè¿™ä¸€æ­¥åœ¨æºç ä¸­å ç”¨å¾ˆå¤§çš„ç¯‡å¹…ï¼Œä¸‹ç¯‡è®²è§£ã€‚å–å°¤é›¨æºªæœ¬äººè¯„ä»·<code>Svelte</code>ä¸­çš„ä¸€å¥è¯(çŸ¥ä¹)ï¼šâ€œSvelte çš„ç¼–è¯‘ç­–ç•¥å†³å®šäº†å®ƒè·Ÿ Virtual DOM ç»ç¼˜ï¼ˆæ¸²æŸ“å‡½æ•°ç”±äºå…¶åŠ¨æ€æ€§ï¼Œæ— æ³•åƒæ¨¡æ¿é‚£æ ·å¯ä»¥è¢«å¯é åœ°é™æ€åˆ†æï¼‰ï¼Œä¹Ÿå°±äº«å—ä¸åˆ° Virtual DOM å¸¦æ¥çš„è¯¸å¤šå¥½å¤„ï¼Œæ¯”å¦‚åŸºäº render function çš„ç»„ä»¶çš„å¼ºå¤§æŠ½è±¡èƒ½åŠ›ï¼ŒåŸºäº vdom åšæµ‹è¯•ï¼ŒæœåŠ¡ç«¯/åŸç”Ÿæ¸²æŸ“äº²å’Œæ€§ç­‰ç­‰ã€‚â€
æ¥çœ‹çœ‹è¿™ä¸ª<code>vnode</code>å¯¹è±¡æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">VNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VNode</span><span class="token punctuation">(</span>
  <span class="token parameter">tag<span class="token punctuation">,</span>
  data<span class="token punctuation">,</span>
  children<span class="token punctuation">,</span>
  text<span class="token punctuation">,</span>
  elm<span class="token punctuation">,</span>
  context<span class="token punctuation">,</span>
  componentOptions<span class="token punctuation">,</span>
  asyncFactory</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag<span class="token punctuation">;</span> <span class="token comment">// æ ‡ç­¾å</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token comment">// ç¼–è¯‘æ¥çš„æ¨¡ç‰ˆæ•°æ® vnodedata</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> children<span class="token punctuation">;</span> <span class="token comment">// å­vnodeæ•°ç»„</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span> <span class="token comment">// ç°å®çš„æ–‡æœ¬å†…å®¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>elm <span class="token operator">=</span> elm<span class="token punctuation">;</span> <span class="token comment">// çœŸå®domå…ƒç´ </span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ns <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å½“å‰å…ƒç´ çš„å‘½åç©ºé—´  ä¾‹å¦‚ &lt;abc:test /&gt; ä¸­çš„abc</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span> <span class="token comment">// æ¸²æŸ“ä¸Šä¸‹æ–‡ çˆ¶vm å»æ¸²æŸ“ç»„ä»¶å ä½èŠ‚ç‚¹å’Œå¸¸è§„èŠ‚ç‚¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fnContext <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fnOptions <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å¼ç»„ä»¶çš„options</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fnScopeId <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å¼ç»„ä»¶scopeidæ”¯æŒ</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// key</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>componentOptions <span class="token operator">=</span> componentOptions<span class="token punctuation">;</span> <span class="token comment">// ç»„ä»¶options</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å­ç»„ä»¶vmå®ä¾‹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// ç»„ä»¶å ä½vnode</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// htmlæ–‡æœ¬</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isStatic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯é™æ€èŠ‚ç‚¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isRootInsert <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯ä½œä¸ºæ ¹æ’å…¥çš„ ä¸ºäº†transitionç»„ä»¶check</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isComment <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯æ³¨é‡ŠèŠ‚ç‚¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isCloned <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯å…‹éš†èŠ‚ç‚¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isOnce <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯v-onceä¿®é¥°çš„èŠ‚ç‚¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>asyncFactory <span class="token operator">=</span> asyncFactory<span class="token punctuation">;</span> <span class="token comment">//å¼‚æ­¥ç»„ä»¶å·¥å‚</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>asyncMeta <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//æ˜¯ä¸æ˜¯å¼‚æ­¥ç»„ä»¶å ä½èŠ‚ç‚¹</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>vnode</code> æ˜¯å¯¹çœŸå® DOM çš„ä¸€ç§æŠ½è±¡æè¿°ï¼Œå®ƒçš„æ ¸å¿ƒå®šä¹‰æ— éå°±å‡ ä¸ªå…³é”®å±æ€§ï¼Œæ ‡ç­¾åã€æ•°æ®ã€å­èŠ‚ç‚¹ã€é”®å€¼ç­‰ï¼Œå…¶å®ƒå±æ€§éƒ½æ˜¯ç”¨æ¥æ‰©å±• <code>vnode</code> çš„çµæ´»æ€§ä»¥åŠå®ç°ä¸€äº›ç‰¹æ®Š <code>feature</code> çš„ã€‚ç”±äº <code>vnode</code> åªæ˜¯ç”¨æ¥æ˜ å°„åˆ°çœŸå® <code>DOM</code> çš„æ¸²æŸ“ï¼Œä¸éœ€è¦åŒ…å«æ“ä½œ <code>DOM</code> çš„æ–¹æ³•ï¼Œå› æ­¤å®ƒæ˜¯éå¸¸è½»é‡å’Œç®€å•çš„ã€‚</p> <h4 id="vue-prototype-render"><a href="#vue-prototype-render" class="header-anchor">#</a> Vue.prototype._render</h4> <p>åœ¨ä¸Šè¾¹åˆ†æå¾—åˆ°<code>updateComponents</code>ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å°†æ‰§è¡Œåˆ°<code>_render</code>æ–¹æ³•ï¼Œ<code>_render</code>æ–¹æ³•æ‰§è¡Œçš„æ—¶æœºæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ç»„å»ºåˆå§‹åŒ–ï¼Œä¸€ä¸ªæ˜¯ç»„ä»¶æ›´æ–°ï¼Œç»“åˆä¹‹å‰å¯¹ watcher çš„åˆ†æå¾—çŸ¥ï¼Œåˆå§‹åŒ–çš„æ—¶å€™æ¯æ‰ç”¨åˆ°<code>watcher.getter</code>ï¼Œåœ¨æ›´æ–°çš„æ¡ä»¶ä¸‹è°ƒç”¨<code>watcher.update</code>çš„æ—¶å€™ä¹Ÿä¼šè°ƒç”¨<code>watcher.getter</code>ï¼Œä¹Ÿå°±æ˜¯å†æ¬¡è§¦å‘æ›´æ–°ï¼Œæ¥ä¸‹æ¥è¯¦ç»†åˆ†æ<code>_render</code>,ç®€åŒ–ç‰ˆä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token punctuation">{</span>
      render<span class="token punctuation">,</span>
      _parentVnode
    <span class="token punctuation">}</span> <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
</code></pre></div><p>é¦–å…ˆé€šè¿‡è§£æ„æ‹¿åˆ°å½“å‰ vm çš„ render å‡½æ•°å’Œå ä½èŠ‚ç‚¹ vnodeã€‚å¯¹äºåˆå§‹åŒ– new Vue çš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æœ‰ç«™ä½èŠ‚ç‚¹çš„ï¼Œå¯¹äºå­ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ä¸­æ˜¯æ‹¥æœ‰ç«™ä½èŠ‚ç‚¹çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>_parentVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$scopedSlots <span class="token operator">=</span> <span class="token function">normalizeScopedSlots</span><span class="token punctuation">(</span>
    _parentVnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>scopedSlots<span class="token punctuation">,</span>
    vm<span class="token punctuation">.</span>$slots<span class="token punctuation">,</span>
    vm<span class="token punctuation">.</span>$scopedSlots
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm<span class="token punctuation">.</span>$vnode <span class="token operator">=</span> _parentVnode<span class="token punctuation">;</span>
</code></pre></div><p>åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨å ä½èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨å ä½èŠ‚ç‚¹ï¼Œå°±å»æå–éœ€è¦æ¸²æŸ“çš„ä½œç”¨åŸŸæ’æ§½ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œä½œç”¨åŸŸæ’æ§½å°±æ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ç»“æ„å’Œæ ·å¼ï¼Œç„¶ååˆ°äº†å­ç»„ä»¶çš„æ¸²æŸ“ render ä¸­ï¼Œä½¿ç”¨å­ç»„ä»¶çš„æ•°æ®è¿›è¡Œæ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯å®˜ç½‘ä¸­çš„â€œæœ‰æ—¶è®©æ’æ§½å†…å®¹èƒ½å¤Ÿè®¿é—®å­ç»„ä»¶ä¸­æ‰æœ‰çš„æ•°æ®æ˜¯å¾ˆæœ‰ç”¨çš„â€ã€‚åä¹‹ï¼Œå¦‚æœæ²¡æœ‰å ä½èŠ‚ç‚¹ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰éœ€è¦åœ¨å­ç»„ä»¶ä¸­æ¸²æŸ“çš„å†…å®¹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> vnode<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      currentRenderingInstance <span class="token operator">=</span> vm<span class="token punctuation">;</span>
      vnode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_renderProxy<span class="token punctuation">,</span> vm<span class="token punctuation">.</span>$createElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token string">&quot;render&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      currentRenderingInstance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vnode<span class="token punctuation">.</span>parent <span class="token operator">=</span> _parentVnode<span class="token punctuation">;</span>

    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨æ¨¡ç‰ˆç¼–è¯‘å™¨è§£æå‡ºæ¥çš„æˆ–è€…å¼ç”¨æˆ·ä¼ å…¥çš„<code>_c</code>å‡½æ•°è¿›è¡Œ vnode çš„ç”Ÿæˆã€‚æœ€åä¿ç•™å ä½èŠ‚ç‚¹çš„å¼•ç”¨å¹¶è¿”å› vnodeã€‚</p> <h4 id="slot-scopedslot"><a href="#slot-scopedslot" class="header-anchor">#</a> slot scopedSlot</h4> <ul><li>æ™®é€šæ’æ§½çš„æå–</li></ul> <p>åœ¨ initRender çš„åˆ†æè¿‡ç¨‹ä¸­å¾—çŸ¥ï¼Œæ™®é€šæ’æ§½åœ¨åˆå§‹åŒ–<code>$createElement()</code>æ–¹æ³•çš„æ—¶å€™å°±è¿›è¡Œäº†æå–ï¼Œé€šè¿‡<code>resolveSlots</code>ï¼ŒæŸ¥çœ‹å…¶å†…éƒ¨æºç å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolveSlots</span><span class="token punctuation">(</span><span class="token parameter">children<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><ul><li>children å½“å‰ç»„ä»¶å ä½èŠ‚ç‚¹æ‰€åŒ…è£¹çš„æ‰€æœ‰ vnode</li> <li>context å½“å‰ç»„ä»¶å ä½èŠ‚ç‚¹æ‰€åœ¨çš„ vm</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> slots <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// éå†æ‰€æœ‰children</span>
    <span class="token keyword">var</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> child<span class="token punctuation">.</span>data<span class="token punctuation">;</span>  <span class="token comment">// è·å–åˆ°æ¯ä¸ªvnodeçš„vnodedata</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>context <span class="token operator">===</span> context <span class="token operator">||</span> child<span class="token punctuation">.</span>fnContext <span class="token operator">===</span> context<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>slot <span class="token operator">!=</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>åˆ¤æ–­å½“å‰ child çš„æ¸²æŸ“ä½œç”¨åŸŸæ˜¯ä¸æ˜¯å’Œä¼ å…¥çš„ä½œç”¨åŸŸç›¸åŒã€‚å› ä¸ºå¯¹äºæ™®é€šæ’æ§½çš„å†…å®¹æ˜¯è¦åœ¨å ä½èŠ‚ç‚¹æ‰€åœ¨çš„æ¸²æŸ“ä½œç”¨åŸŸä¸‹è¿›è¡Œæ¸²æŸ“çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>      <span class="token keyword">var</span> name <span class="token operator">=</span> data<span class="token punctuation">.</span>slot<span class="token punctuation">;</span> <span class="token comment">// å–åˆ°æ’æ§½å</span>
      <span class="token keyword">var</span> slot <span class="token operator">=</span> <span class="token punctuation">(</span>slots<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>slots<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‰ç…§æ’æ§½åå­—è¿›è¡Œå½’ç±» åˆå§‹åŒ–ä¸ºæ•°ç»„</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'template'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        slot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>slot<span class="token punctuation">,</span> child<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯¹äºtemplateåŒ…è£¹çš„å­å…ƒç´ è¿›è¡Œä¸€æ¬¡æ‹å¹³æ“ä½œ</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        slot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//å…¶ä½™æ’å…¥åˆ°é»˜è®¤æ’æ§½ä¸­</span>
      <span class="token punctuation">(</span>slots<span class="token punctuation">.</span>default <span class="token operator">||</span> <span class="token punctuation">(</span>slots<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> slots <span class="token comment">// æœ€åæŠŠåˆ†ç±»å¥½çš„vnodeæ•°ç»„è¿”å›</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ•´ä¸ª<code>resloveSlots</code>çš„è¿‡ç¨‹å°±æ˜¯å°†å‘½åæ’æ§½è¿›è¡Œåˆ†ç±»ï¼Œå¯¹äºæ²¡æœ‰åˆ†ç±»çš„æ’æ§½å½’äºé»˜è®¤æ’æ§½çš„éƒ¨åˆ†ã€‚</p> <ul><li>ä½œç”¨åŸŸæ’æ§½çš„æå–
å¯¹äºä½œç”¨åŸŸæ’æ§½è¿›è¡Œæ ‡å‡†åŒ–ï¼Œéå†æ¯ä¸ªä½œç”¨åŸŸæ’æ§½è°ƒç”¨<code>normalizeScopedSlot</code>ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">normalizeScopedSlot</span><span class="token punctuation">(</span><span class="token parameter">normalSlots<span class="token punctuation">,</span> key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><ul><li>normalSlots æ™®é€šæ’æ§½</li> <li>key æ’æ§½å</li> <li>fn æ’æ§½å¯¹åº”çš„æ–¹æ³•</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">normalized</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> res <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res <span class="token operator">=</span> res <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> res <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span>res<span class="token punctuation">]</span>
      <span class="token operator">:</span>
      <span class="token function">normalizeChildren</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        res<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>res<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isComment<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span>
      res
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> normalized
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥å‘ç°ä½œç”¨åŸŸæ’æ§½ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯å‡½æ•°ï¼Œå‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹æ˜¯ä»å ä½èŠ‚ç‚¹æ‹¿åˆ°å­èŠ‚ç‚¹å†…éƒ¨æ‰§è¡Œçš„ï¼Œç›¸å½“äºæ˜¯åœ¨çˆ¶ç»„ä»¶å®šä¹‰ï¼Œåœ¨å­ç»„ä»¶æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨å­ç»„ä»¶æ•°æ®çš„åŸå› ï¼Œæ¸²æŸ“æ—¶å°±ä¼šæ‰§è¡Œæ¯ä¸€ä¸ªä½œç”¨åŸŸæ’æ§½çš„æ–¹æ³•ï¼Œå¾—åˆ°å…¶ä¸­çš„ vnodeï¼Œæœ€ååœ¨ç»è¿‡ä¸€æ¬¡æ ‡å‡†åŒ–è¿”å›è¿™ä¸ª vnode æ•°ç»„ã€‚</p> <h4 id="c"><a href="#c" class="header-anchor">#</a> <code>_c</code></h4> <p>æ‰§è¡Œå®Œ<code>normalizeScopeSlots</code>ä¹‹åæ‰§è¡Œ<code>render.call</code>å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œä»æ¨¡ç‰ˆç¼–è¯‘æ¥çš„<code>render</code>å‡½æ•°,è¿›è€Œæ‰§è¡Œ<code>_c</code>ã€‚å…ˆç®€å•çœ‹ä¸€ä¸ª render å‡½æ•°çš„ç¼–è¯‘åçš„ä»£ç ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">_c</span><span class="token punctuation">(</span>
  <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token comment">// tag</span>
  <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// vnodedata</span>
  <span class="token punctuation">[</span>
    <span class="token comment">// children</span>
    <span class="token function">_c</span><span class="token punctuation">(</span>
      <span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token comment">//tag</span>
      <span class="token punctuation">{</span> on<span class="token operator">:</span> <span class="token punctuation">{</span> click<span class="token operator">:</span> _vm<span class="token punctuation">.</span>show <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//vnodedata</span>
      <span class="token punctuation">[</span>_vm<span class="token punctuation">.</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">//children</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_c</span><span class="token punctuation">(</span>
      <span class="token string">&quot;main-tab-bar&quot;</span><span class="token punctuation">,</span> <span class="token comment">//tag</span>
      <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> cool<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">// vnodedata</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¯¹ç…§å…¶æ¨¡ç‰ˆå¦‚ä¸‹ï¼š</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main-tab-bar</span> <span class="token attr-name">cool</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main-tab-bar</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åœ¨ç¬¬ä¸€ç« ã€Šåœ¨ new vue ä¹‹å‰åšçš„å·¥ä½œã€‹ä¸€ç« ä¸­å·²ç»æè¿°è¿‡,<code>_c</code>æ˜¯åˆ›å»º vnode çš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°æ•´ä¸ª render å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œä¸€ä¸ª<code>_c('div')</code>åŒ…è£¹ä¸¤ä¸ª<code>_c(&quot;button&quot;)</code>å’Œ<code>_c('main-tab-bar')</code>ï¼Œåä¸¤ä¸ª<code>_c</code>ä½œä¸ºç¬¬ä¸€ä¸ª<code>_c</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼Œå…¶åˆšå¥½å¯¹åº”åˆ°æ¨¡ç‰ˆä¸­çš„ button å’Œ main-tab-bar æ ‡ç­¾ã€‚å†æ¥çœ‹æ ‡ç­¾ä¸Šçš„å±æ€§ï¼Œ<code>id=&quot;app&quot;</code>è¢«ç¼–è¯‘æˆ<code>attrs:{id:&quot;app&quot;}</code>è¿™ä¸ªå¯¹è±¡è¢«ä¿å­˜ï¼ŒåŒç† coolã€‚åœ¨çœ‹ç»‘å®šçš„æ–¹æ³•åˆ™æ˜¯å­˜å‚¨åˆ°äº†<code>on:{click:_vm.show}</code>å¯¹è±¡ä¸­å»ã€‚å¤æ‚çš„æ¨¡ç‰ˆç¼–è¯‘ä¹Ÿæ˜¯åŒç†äºæ­¤ï¼Œæ˜¯ä¸€ä¸ªç”Ÿæˆ astï¼ˆæè¿° html èŠ‚ç‚¹çš„ä¸€ä¸ªå¯¹è±¡ï¼‰çš„è¿‡ç¨‹ï¼Œåœ¨é€šè¿‡<code>_c</code>ç”Ÿæˆ vnode å¯¹è±¡ï¼Œæœ€åé€šè¿‡<code>_update</code>è¿‡ç¨‹å»æ„å»º dom æ ‘ï¼ˆä¸‹ä¸€å¼ åšè¯¦ç»†ä»‹ç»ï¼‰ã€‚æ¥ä¸‹æ¥çœ‹çœ‹<code>_c</code>åˆ°åº•æ˜¯ä»€ä¹ˆï¼ŒæŸ¥çœ‹ä»¥ä¸‹ä»£ç :</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function-variable function">_c</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>a å…ƒç´ åï¼Œæ¯”å¦‚<code>buttonï¼Œmain-tab-bar</code></li> <li>b vnodedata å¯¹è±¡ <code>{attrs:{id:&quot;app&quot;},on:{click:_vm.show}}</code></li> <li>c å­ vnode æ•°ç»„ <code>[_c('div'),_c('main')]</code></li> <li>d æ˜¯å¦éœ€è¦ä¸¥æ ¼æ ‡å‡†åŒ–çš„æ ‡å¿—
å¯ä»¥å‘ç°<code>_c</code>è°ƒç”¨äº†<code>createElement</code>,æ¥ä¸‹æ¥çœ‹è¿™ä¸ªæ–¹æ³•çš„å†…éƒ¨å®ç°ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token parameter">context<span class="token punctuation">,</span>
  tag<span class="token punctuation">,</span>
  data<span class="token punctuation">,</span>
  children<span class="token punctuation">,</span>
  normalizationType<span class="token punctuation">,</span>
  alwaysNormalize</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€šè¿‡åˆ¤æ–­è¿›è¡Œå‚æ•°å‰ç§»</span>
    normalizationType <span class="token operator">=</span> children<span class="token punctuation">;</span>
    children <span class="token operator">=</span> data<span class="token punctuation">;</span>
    data <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>alwaysNormalize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    normalizationType <span class="token operator">=</span> <span class="token constant">ALWAYS_NORMALIZE</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">_createElement</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> normalizationType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ ‡å‡†åŒ–åå¼€å§‹çœŸæ­£çš„createElemnt</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œå‘ç°åœ¨<code>vnodedata</code>ä¼ å…¥äº†ä¸€ä¸ªæ•°ç»„æˆ–è€…æ˜¯ä¸€ä¸ª<code>primitive</code>å€¼(<code>symbol,string,number,boolean</code>å››ä¸ªä¹‹ä¸€)çš„æ—¶å€™ï¼Œå°±åšå‚æ•°åç§»æ“ä½œï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å¯ä»¥è®©ç”¨æˆ·ä½¿ç”¨ render å‡½æ•°çš„æ—¶å€™å¯ä»¥æ›´çµæ´»çš„ä¼ é€’å‚æ•°ï¼Œå¯ä»¥å§å­ vnode ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œä¹Ÿæ˜¯åœ¨ js æ¡†æ¶ä¸­å¸¸åšçš„ç»†èŠ‚å¤„ç†ã€‚æœ€ååšå®Œå‚æ•°æ ‡å‡†åŒ–ä¹‹åå¼€å§‹åˆ›å»º vnodeï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹<code>_createElement</code>çš„å®ç°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¿™æ­£å¼å¼€å§‹åˆ›å»ºvnode</span>
<span class="token keyword">function</span> <span class="token function">_createElement</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span>tag<span class="token punctuation">,</span>data<span class="token punctuation">,</span>children<span class="token punctuation">,</span>normalizationType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>scopedSlots <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token operator">:</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    children<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¾¹éƒ¨åˆ†ä»£ç å¯¹äºä½œç”¨åŸŸæ’æ§½åšäº†é¢å¤–å¤„ç†ï¼Œå¦‚æœä¼ å…¥äº†ä¸€ä¸ªæ•°ç»„ä¸”ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ å¼æ–¹æ³•çš„è¯å°±ä½œä¸ºä½œç”¨åŸŸæ’æ§½å¯¹è±¡ä¸­çš„é»˜è®¤å€¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>normalizationType <span class="token operator">===</span> <span class="token constant">ALWAYS_NORMALIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  children <span class="token operator">=</span> <span class="token function">normalizeChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>normalizationType <span class="token operator">===</span> <span class="token constant">SIMPLE_NORMALIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  children <span class="token operator">=</span> <span class="token function">simpleNormalizeChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>render å‡½æ•°æœ‰ç”¨æˆ·æ‰‹å†™çš„ render å‡½æ•°å’Œç¼–è¯‘å™¨ç”Ÿæˆçš„ render å‡½æ•°ï¼Œå¯¹äºä¸åŒçš„ render å‡½æ•°ä¼ å…¥çš„ children æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚ç”¨æˆ·å¯¹äºæ‰‹å†™çš„ render å‡½æ•°ä¸­çš„ children å¯ä»¥ä¼ å…¥æ•°ç»„ï¼Œå¯¹è±¡ï¼Œprimitive å€¼ï¼Œè€Œé€šè¿‡ vue å†…éƒ¨ç¼–è¯‘å¾—æ¥çš„ render å‡½æ•°å´å…¨éƒ¨æ˜¯ä¸¥æ ¼çš„æ•°ç»„ï¼Œæ‰€ä»¥å¯¹äºä¸åŒçš„ render å‡½æ•°åº”è¯¥é‡‡ç”¨ä¸åŒçš„æ ‡å‡†åŒ–ï¼Œä¿è¯å¯¹ç”¨æˆ·æä¾›çš„ api æ›´åŠ å‹å¥½ã€‚å¦‚æœæ˜¯ç”¨æˆ·ä¼ å…¥çš„ render å‡½æ•°ï¼Œå§‹ç»ˆè¿›è¡Œå¤æ‚çš„é€’å½’å¼çš„ children æ ‡å‡†åŒ–ï¼Œå…¶ä½™ç¼–è¯‘å™¨ç”Ÿæˆçš„æƒ…å†µä»…ä»…éœ€è¦ç®€å•çš„,å•å±‚çš„,æ‰å¹³åˆå§‹åŒ–æ“ä½œã€‚è¿›è¡Œåˆå§‹åŒ–å®Œæ¯•ä¹‹åï¼Œå¾—åˆ°å­èŠ‚ç‚¹æ•°ç»„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> vnode<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> Ctor<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯ä¿ç•™æ ‡ç­¾ å¦‚æœæ˜¯ç›´æ¥åˆ›å»ºvnode</span>
      vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
        tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>Ctor <span class="token operator">=</span> <span class="token comment">/* å¯¹äºéä¿ç•™æ ‡ç­¾è¿›è¡Œèµ„æºè·å–*/</span> <span class="token function">resolveAsset</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>$options<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–åˆ°ç»„ä»¶optionsä¹‹ååˆ›å»ºç»„ä»¶vnode</span>
      vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
        tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">registerDeepBindings</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åˆ¤æ–­å½“å‰ä¼ å…¥çš„æ ‡ç­¾åæ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²å°±å†å»åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰å¹³å°ä¸‹çš„å†…ç½®æ ‡ç­¾ï¼Œä¾‹å¦‚ web å¹³å°ä¸‹å°±æ˜¯<code>div main p h1</code>ç­‰ç­‰,ç„¶åé€šè¿‡<code>new vnode</code>å»åˆ›å»ºå†…ç½®æ ‡ç­¾çš„<code>vnode</code>å¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯å†…ç½®æ ‡ç­¾ï¼Œå°±ä»£è¡¨å½“å‰ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯ç»„ä»¶æ ‡ç­¾ï¼Œäºæ˜¯é€šè¿‡<code>resolveAsset</code>å»è·å–ç»„ä»¶æ„é€ å™¨ï¼Œæœ€åé€šè¿‡<code>createComponet</code>å»åˆ›å»ºç»„å»ºå¯¹åº”çš„<code>vnode</code>ï¼Œå›åˆ°ä¸€å¼€å§‹ï¼Œå¦‚æœæ•´ä¸ªæ–¹æ³•ä¼ å…¥çš„ tag å°±æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±ç›´æ¥å°† tag ä½œä¸ºæ„é€ å™¨ä¼ å…¥<code>createComponent</code>ã€‚æœ€åç»è¿‡ç®€å•çš„åˆ¤æ–­ä¹‹åå¹¶æ‰§è¡Œ<code>registerDeepBindings</code>åè¿”å› vnodeã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p> <ul><li>resolveAsset è·å–èµ„æºï¼Œä¸ä»…ä»…æ˜¯ç»„ä»¶æ„é€ å™¨ï¼Œè¿˜åŒ…æ‹¬æŒ‡ä»¤ï¼Œè¿‡æ»¤å™¨.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolveAsset</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> type<span class="token punctuation">,</span> id<span class="token punctuation">,</span> warnMissing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> assets <span class="token operator">=</span> options<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç°åœ¨ç»„ä»¶è‡ªèº«optionså­˜ä¸å­˜åœ¨å½“å‰èµ„æº</span>
    <span class="token keyword">return</span> assets<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> camelizedId <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> camelizedId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°è¯•å¯»æ‰¾camelæ ¼å¼çš„idå¯¹å¯¹åº”çš„èµ„æº</span>
    <span class="token keyword">return</span> assets<span class="token punctuation">[</span>camelizedId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> PascalCaseId <span class="token operator">=</span> <span class="token function">capitalize</span><span class="token punctuation">(</span>camelizedId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯»æ‰¾pascalæ ¼å¼çš„idå¯¹åº”çš„èµ„æº</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> PascalCaseId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> assets<span class="token punctuation">[</span>PascalCaseId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// fallback to prototype chain æœ€åå›é€€åˆ°åŸå‹é“¾æŸ¥æ‰¾</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> assets<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> assets<span class="token punctuation">[</span>camelizedId<span class="token punctuation">]</span> <span class="token operator">||</span> assets<span class="token punctuation">[</span>PascalCaseId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¦‚æœåœ¨å½“å‰ option æ‰¾ä¸åˆ°å½“å‰å¯¹åº”çš„èµ„æº,å°±å»åŸå‹é“¾ä¸­æŸ¥æ‰¾,æŒ‰ç…§<code>id &gt; camel &gt; pascal</code>æ ¼å¼çš„ä¼˜å…ˆçº§å»å¯»æ‰¾å½“å‰èµ„æº,æ€»ä½“çš„æ€è·¯å°±æ˜¯å…ˆæŸ¥å±€éƒ¨åœ¨æŸ¥å…¨å±€,é‚£ä¹ˆå…¨å±€çš„èµ„æºæ˜¯å¦‚ä½•æŒ‚åˆ°åŸå‹é“¾ä¸Šå‘¢?ä½¿ç”¨<code>Vue.component</code>çš„æ—¶å€™é€šè¿‡<code>this.options._base.extend()</code>å»é“¾æ¥åŸå‹é“¾ã€‚æœ€åå¾—åˆ°çš„ç»„ä»¶å¯¹è±¡å…¶å®å°±æ˜¯é€šè¿‡æ¯ä¸ªå­ç»„ä»¶ä¸­ <code>export default {}</code>å¯¼å‡ºçš„å¯¹è±¡ã€‚</p> <ul><li>createComponent
ç”¨äºåˆ›å»ºç»„ä»¶çš„ vnodeã€‚æŸ¥çœ‹å¦‚ä¸‹ä»£ç æ—¶å®ç°ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token parameter">Ctor<span class="token punctuation">,</span> data<span class="token punctuation">,</span>context<span class="token punctuation">,</span>children<span class="token punctuation">,</span> tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> baseCtor <span class="token operator">=</span> context<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_base<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Ctor <span class="token operator">=</span> baseCtor<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>æŠŠæ™®é€šé€‰é¡¹å¯¹è±¡è½¬æ¢ä¸ºç»„ä»¶æ„é€ å™¨æ„é€ å‡½æ•°ï¼Œåç»­ä½œä¸ºå­ç»„ä»¶çš„<code>vnode.componentsOptions</code>ä¼ å…¥ï¼Œä»¥å¤‡åç»­é€’å½’åˆ›å»ºå­ç»„ä»¶ vm æ—¶è°ƒç”¨ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> propsData <span class="token operator">=</span> <span class="token function">extractPropsFromVNodeData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Ctor<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> listeners <span class="token operator">=</span> data<span class="token punctuation">.</span>on<span class="token punctuation">;</span>
data<span class="token punctuation">.</span>on <span class="token operator">=</span> data<span class="token punctuation">.</span>nativeOn<span class="token punctuation">;</span>
<span class="token function">installComponentHooks</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name <span class="token operator">||</span> tag<span class="token punctuation">;</span>
</code></pre></div><p>å¯¹ç»„ä»¶æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä¾‹å¦‚ä»æ¨¡ç‰ˆç¼–è¯‘æ¥çš„ vnodedata ä¸­æå–éœ€è¦ä¼ é€’åˆ°å­ç»„ä»¶çš„æ•°æ®<code>propsData</code>ï¼Œå°†<code>native</code>åŒ–çš„æ–¹æ³•ï¼ˆçˆ¶ç»„ä»¶è°ƒç”¨ï¼‰å’Œéœ€è¦å­ç»„ä»¶<code>$emit</code>çš„æ–¹æ³•åˆ†ç¦»ã€‚å®‰è£…ç»„ä»¶é’©å­ï¼Œæ•´ä¸ª<code>installComponentHooks</code>çš„è¿‡ç¨‹å°±æ˜¯æŠŠ<code>componentVNodeHooks</code>çš„é’©å­å‡½æ•°åˆå¹¶åˆ°<code>data.hook</code>ä¸­ï¼Œåœ¨<code>vnode</code>æ‰§è¡Œ<code>patch</code>çš„å„ä¸ªé˜¶æ®µä¸­æ‰§è¡Œç›¸å…³çš„é’©å­å‡½æ•°ã€‚è¿™äº›é’©å­å‡½æ•°éƒ½ååˆ†é‡è¦ï¼Œåœ¨<code>patch</code>ç« èŠ‚ä¼šè¯¦ç»†è®²è§£ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token string">&quot;vue-component-&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>cid<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>name <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      Ctor<span class="token operator">:</span> Ctor<span class="token punctuation">,</span>
      propsData<span class="token operator">:</span> propsData<span class="token punctuation">,</span>
      listeners<span class="token operator">:</span> listeners<span class="token punctuation">,</span>
      tag<span class="token operator">:</span> tag<span class="token punctuation">,</span>
      children<span class="token operator">:</span> children
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">null</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre></div><p>æœ€åä¼ å…¥æ‰€æœ‰å‡†å¤‡å¥½çš„æ•°æ®ï¼Œç„¶ååˆ›å»ºç»„ä»¶å¯¹åº”çš„<code>vnode</code>å¯¹è±¡ã€‚</p> <h4 id="ç»“"><a href="#ç»“" class="header-anchor">#</a> ç»“</h4> <p>å…¶å®æ•´ä¸ª render è¿‡ç¨‹æ˜¯å§ä¿ç•™æ ‡ç­¾å’Œç»„ä»¶æ ‡ç­¾è¿›è¡Œäº†åŒºåˆ†å¤„ç†ï¼Œåˆ†åˆ«åˆ›å»ºä¸åŒçš„ vnodeï¼Œå¯¹äºç»„ä»¶æ ‡ç­¾ä¼šæœ‰çˆ¶å­ç»„ä»¶çš„æ•°æ®ä¼ é€’ï¼Œåƒæ˜¯ on ç»‘å®šçš„æ–¹æ³•å’Œ attrs ç­‰æ•°æ®ã€‚è¿™äº›æ•°æ®éƒ½è¢«åŒ…è£¹åœ¨ vnodedata ä¸­ã€‚ç„¶ååœ¨åˆ›å»º vnode çš„æ—¶å€™ä¹Ÿä¸º vnodedata æ·»åŠ äº†ä¸€äº›åœ¨ patch ä¸­ä¼šç”¨åˆ°çš„é’©å­ï¼Œä¸ºåç»­åšå‡†å¤‡ã€‚</p> <h4 id="ã€Šå®Œã€‹"><a href="#ã€Šå®Œã€‹" class="header-anchor">#</a> ã€Šå®Œã€‹</h4></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/frontend/vue_vuex_vue-router_nuxt/vcode/4.html" class="prev">
        initStateä¸å“åº”å¼åŸç†ï¼ˆå››ï¼‰
      </a></span> <span class="next"><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/diff.html">
        diff æºç  æ³¨é‡Šç‰ˆ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d0f45259.js" defer></script><script src="/assets/js/2.9e697bc4.js" defer></script><script src="/assets/js/47.869f0654.js" defer></script>
  </body>
</html>
